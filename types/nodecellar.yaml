################################################################
# Blueprint node types.
#
# specific new types for the nodecellar app.
# these types are mapped to scripts that are resposible
# for the lifecycle operation.
################################################################

node_types:

  cloudify.nodes.nodecellar.MongoDatabase:
    derived_from: cloudify.nodes.DBMS
    properties:
      role:
        description: MongoDB role
        type: string
      port:
        description: MongoDB port
        type: integer
    interfaces:
      cloudify.interfaces.lifecycle:
        create: scripts/mongo/install-mongo.sh
        start: scripts/mongo/start-mongo.sh
        stop: scripts/mongo/stop-mongo.sh

  cloudify.nodes.nodecellar.NodeJSServer:
    derived_from: cloudify.nodes.ApplicationServer
    interfaces:
      cloudify.interfaces.lifecycle:
        create: scripts/nodejs/install-nodejs.sh

  cloudify.nodes.nodecellar.GithubNodecellarApplicationModule:
    derived_from: cloudify.nodes.ApplicationModule
    properties:
      organization:
        description: >
          The Name of the organization the application repo belongs to.
        type: string
        default: cloudify-cosmo
      repo:
        description: >
          The Name of the repository containing the application sources.
        type: string
        default: nodecellar
      branch:
        description: >
          The Name of the branch to be installed.
        type: string
        default: master
      port:
        description: Web application port
        type: integer
      startup_script:
        description: Web application port
        type: string
        default: server.js
    interfaces:
      cloudify.interfaces.lifecycle:
        configure: scripts/nodecellar/install-nodecellar-app.sh
        start: scripts/nodecellar/start-nodecellar-app.sh
        stop: scripts/nodecellar/stop-nodecellar-app.sh

relationships:

  nodecellar_application_connected_to_mongo:
    derived_from: cloudify.relationships.connected_to
    target_interfaces:
      cloudify.interfaces.relationship_lifecycle:
          postconfigure: scripts/mongo/set-ip.sh


  nodecellar_application_contained_in_nodejs:
    derived_from: cloudify.relationships.contained_in
    target_interfaces:
      cloudify.interfaces.relationship_lifecycle:
          preconfigure: scripts/nodejs/set-root.sh
